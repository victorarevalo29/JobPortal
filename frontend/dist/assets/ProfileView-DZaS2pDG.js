import{_ as le,p as se,r as B,s as I,c as k,x as O,a as i,f as oe,l as A,d as n,w as h,g as r,b as s,m as f,t as g,A as ae,B as x,h as E,n as m,i as D,j as M,v as R,F as te,e as re}from"./index-Cw7ty9o7.js";import{B as q}from"./BaseCard-B_bAREMe.js";import{B as U}from"./BaseInput-DF9V6cTV.js";const ie={class:"profile"},ne={key:0,class:"profile__stack"},de={class:"hero-card__inner"},ue={class:"hero-card__identity"},me={class:"hero-card__avatar-ring"},pe=["src"],ce={class:"hero-card__meta-row"},fe={class:"hero-card__role-pill"},ve={class:"hero-card__email"},ge={key:0,class:"hero-card__company"},ye={class:"hero-card__company-meta"},be={class:"hero-card__status"},Ue={class:"hero-card__status-label"},ke={class:"hero-card__status-value"},he={class:"hero-card__progress"},_e={key:0,class:"profile__tabs"},Ve={class:"panel-card"},Ce={class:"panel-grid"},Be={key:0},je={key:0},we={class:"panel-field"},xe={class:"panel-card"},Ee={class:"photo-card"},Pe=["src"],Se={key:0},$e={class:"panel-card"},ze={key:0},Fe={class:"panel-actions"},Ie={class:"panel-card"},Ae={class:"panel-field"},qe={key:0,class:"skills-chips"},Ne={class:"profile__form-actions"},Le={class:"panel-card"},Te={class:"panel-grid"},Oe={key:0},De={class:"panel-grid"},Me={key:0},Re={key:0},Ge={class:"profile__form-actions"},He={__name:"ProfileView",setup(Je){const v=se(),a=B({name:"",email:"",photoUrl:"",resumeUrl:"",bio:""}),P=I(""),y=B({message:"",type:""}),_=B({name:!1,email:!1,photoUrl:!1,resumeUrl:!1}),t=B({name:"",industry:"",location:"",description:"",logoUrl:""}),V=B({name:!1,industry:!1,location:!1,description:!1,logoUrl:!1}),p=B({message:"",type:""}),$=I(!1),C=I("personal"),G=k(()=>{var l;return((l=v.user)==null?void 0:l.role)==="employer"?"Employer":"Talento"}),H=k(()=>v.profileSaving),j=k(()=>{var l;return((l=v.user)==null?void 0:l.role)==="employer"}),N=k(()=>{if(a.photoUrl)return a.photoUrl;const l=a.name||"JobPortal";return`https://ui-avatars.com/api/?name=${encodeURIComponent(l)}&background=2563eb&color=f8fafc`}),z=k(()=>{const l=["name","email","resumeUrl","bio"],e=l.reduce((o,u)=>{var d;return(d=a[u])!=null&&d.trim()?o+1:o},0);return Math.round(e/l.length*100)}),J=k(()=>z.value>=80?"Perfil casi listo":"Sigue completando tus datos"),F=k(()=>P.value.split(",").map(l=>l.trim()).filter(Boolean)),L=k(()=>{var l,e;return((e=(l=v.user)==null?void 0:l.company)==null?void 0:e.name)||t.name||""});O(j,l=>{l||(C.value="personal")});const T=l=>{t.name=(l==null?void 0:l.name)||"",t.industry=(l==null?void 0:l.industry)||"",t.location=(l==null?void 0:l.location)||"",t.description=(l==null?void 0:l.description)||"",t.logoUrl=(l==null?void 0:l.logoUrl)||"",Object.keys(V).forEach(e=>{V[e]=!1}),p.message="",p.type=""},X=l=>{a.name=(l==null?void 0:l.name)||"",a.email=(l==null?void 0:l.email)||"",a.photoUrl=(l==null?void 0:l.photoUrl)||"",a.resumeUrl=(l==null?void 0:l.resumeUrl)||"",a.bio=(l==null?void 0:l.bio)||"",P.value=Array.isArray(l==null?void 0:l.skills)?l.skills.join(", "):"",Object.keys(_).forEach(e=>{_[e]=!1}),T(l==null?void 0:l.company)};O(()=>v.user,l=>{X(l)},{immediate:!0});const K={name:l=>l.trim().length>=3,email:l=>/.+@.+\..+/.test(l.trim()),photoUrl:l=>!l||/^https?:\/\//i.test(l.trim()),resumeUrl:l=>!l||/^https?:\/\//i.test(l.trim())},Q={name:l=>l.trim().length>=2,industry:l=>!l||l.trim().length>=2,location:l=>!l||l.trim().length>=2,logoUrl:l=>!l||/^https?:\/\//i.test(l.trim()),description:l=>l.length<=1500},S=l=>{_[l]=!0},c=l=>{const e=K[l];return e?_[l]&&!e(a[l]||""):!1},w=l=>{V[l]=!0},b=l=>{const e=Q[l];return e?V[l]&&!e(t[l]||""):!1},W=()=>{const l={name:t.name.trim(),industry:t.industry.trim(),location:t.location.trim(),description:t.description.trim(),logoUrl:t.logoUrl.trim()};return Object.fromEntries(Object.entries(l).filter(([,e])=>!!e))},Y=()=>{a.resumeUrl&&window.open(a.resumeUrl,"_blank")},Z=async()=>{var e,o;if(y.message="",Object.keys(_).forEach(u=>{_[u]=!0}),c("name")||c("email")||c("photoUrl")||c("resumeUrl")){y.message="Revisa los campos marcados en rojo.",y.type="error";return}const l={name:a.name.trim(),email:a.email.trim(),photoUrl:a.photoUrl.trim(),resumeUrl:a.resumeUrl.trim(),bio:a.bio.trim(),skills:F.value};Object.entries(l).forEach(([u,d])=>{(typeof d=="string"&&d===""||Array.isArray(d)&&!d.length)&&delete l[u]});try{await v.updateProfile(l),y.message="Perfil actualizado",y.type="success"}catch(u){y.message=u.message||((o=(e=u==null?void 0:u.errors)==null?void 0:e[0])==null?void 0:o.msg)||"No se pudo actualizar",y.type="error"}},ee=async()=>{var e,o,u;if(!j.value)return;if(p.message="",Object.keys(V).forEach(d=>{V[d]=!0}),b("name")||b("logoUrl")){p.message="Verifica los campos de empresa marcados",p.type="error";return}const l={company:W()};$.value=!0;try{await v.updateProfile(l),p.message="Empresa actualizada",p.type="success",T((e=v.user)==null?void 0:e.company)}catch(d){p.message=d.message||((u=(o=d==null?void 0:d.errors)==null?void 0:o[0])==null?void 0:u.msg)||"No se pudo actualizar la empresa",p.type="error"}finally{$.value=!1}};return(l,e)=>(r(),i("section",ie,[A(v).isAuthenticated?(r(),i("div",ne,[n(q,{class:"profile__hero-card"},{default:h(()=>[s("div",de,[s("div",ue,[s("div",me,[s("img",{src:N.value,alt:"Foto de perfil",class:"hero-card__avatar"},null,8,pe)]),s("div",null,[e[23]||(e[23]=s("p",{class:"section-kicker"},"Perfil principal",-1)),s("h1",null,g(a.name||"Tu nombre"),1),s("div",ce,[s("span",fe,g(G.value),1),s("span",ve,g(a.email||"tu@correo.com"),1)])])]),j.value&&L.value?(r(),i("div",ge,[e[24]||(e[24]=s("p",{class:"section-kicker"},"Empresa",-1)),s("h3",null,g(L.value),1),s("p",ye,g(t.industry||t.location||"Completa la ficha de tu empresa"),1)])):f("",!0),s("div",be,[s("div",null,[s("p",Ue,g(J.value),1),s("p",ke,g(z.value)+"%",1)]),s("div",he,[s("div",{class:"hero-card__progress-bar",style:ae({"--progress":z.value+"%"})},null,4)]),n(x,{variant:"ghost",size:"sm",onClick:A(v).logout},{default:h(()=>[...e[25]||(e[25]=[E("Cerrar sesión",-1)])]),_:1},8,["onClick"])])])]),_:1}),n(q,{class:"profile__form-shell"},{default:h(()=>[e[45]||(e[45]=s("header",{class:"form-shell__header"},[s("div",null,[s("p",{class:"section-kicker"},"Edición de perfil"),s("h2",null,"Actualiza tu presencia profesional")]),s("p",null,"Comparte contexto, habilidades y enlaces para facilitar mejores conexiones.")],-1)),j.value?(r(),i("div",_e,[s("button",{type:"button",class:m(["profile__tab",{"is-active":C.value==="personal"}]),onClick:e[0]||(e[0]=o=>C.value="personal")}," Perfil personal ",2),s("button",{type:"button",class:m(["profile__tab",{"is-active":C.value==="company"}]),onClick:e[1]||(e[1]=o=>C.value="company")}," Empresa ",2)])):f("",!0),!j.value||C.value==="personal"?(r(),i("form",{key:1,class:"profile__panel-stack",onSubmit:D(Z,["prevent"])},[s("section",Ve,[e[30]||(e[30]=s("header",null,[s("div",null,[s("p",{class:"section-kicker"},"Información personal"),s("h3",null,"Datos visibles para la comunidad")])],-1)),s("div",Ce,[s("div",{class:m(["panel-field",{"has-error":c("name")}])},[e[26]||(e[26]=s("label",null,"Nombre completo",-1)),n(U,{modelValue:a.name,"onUpdate:modelValue":e[2]||(e[2]=o=>a.name=o),placeholder:"Ej. Marcela Duarte",required:"",onBlur:e[3]||(e[3]=o=>S("name"))},null,8,["modelValue"]),c("name")?(r(),i("small",Be,"Ingresa al menos 3 caracteres.")):f("",!0)],2),s("div",{class:m(["panel-field",{"has-error":c("email")}])},[e[27]||(e[27]=s("label",null,"Correo",-1)),n(U,{type:"email",modelValue:a.email,"onUpdate:modelValue":e[4]||(e[4]=o=>a.email=o),placeholder:"tu@correo.com",required:"",onBlur:e[5]||(e[5]=o=>S("email"))},null,8,["modelValue"]),c("email")?(r(),i("small",je,"Usa un correo válido.")):f("",!0)],2)]),s("div",we,[e[28]||(e[28]=s("label",null,"Bio",-1)),M(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=o=>a.bio=o),rows:"4",placeholder:"Comparte qué te apasiona"},null,512),[[R,a.bio]]),e[29]||(e[29]=s("small",null,"Comparte logros o contextos que ayuden a tu próximo match.",-1))])]),s("section",xe,[e[32]||(e[32]=s("header",null,[s("div",null,[s("p",{class:"section-kicker"},"Foto de perfil"),s("h3",null,"Cuéntale al resto quién eres")])],-1)),s("div",Ee,[s("img",{src:N.value,alt:"Vista previa",class:"photo-card__preview"},null,8,Pe),s("div",{class:m(["panel-field",{"has-error":c("photoUrl")}])},[e[31]||(e[31]=s("label",null,"URL de la imagen",-1)),n(U,{modelValue:a.photoUrl,"onUpdate:modelValue":e[7]||(e[7]=o=>a.photoUrl=o),placeholder:"https://uploads.jobportal.dev/avatar.jpg",onBlur:e[8]||(e[8]=o=>S("photoUrl"))},null,8,["modelValue"]),c("photoUrl")?(r(),i("small",Se,"Usa un enlace que comience con http(s).")):f("",!0)],2)])]),s("section",$e,[e[34]||(e[34]=s("header",null,[s("div",null,[s("p",{class:"section-kicker"},"CV y portafolio"),s("h3",null,"Comparte tu mejor entrega")])],-1)),s("div",{class:m(["panel-field",{"has-error":c("resumeUrl")}])},[e[33]||(e[33]=s("label",null,"Link público",-1)),n(U,{modelValue:a.resumeUrl,"onUpdate:modelValue":e[9]||(e[9]=o=>a.resumeUrl=o),placeholder:"https://mi-portafolio.dev",onBlur:e[10]||(e[10]=o=>S("resumeUrl"))},null,8,["modelValue"]),c("resumeUrl")?(r(),i("small",ze,"Comparte un enlace válido.")):f("",!0)],2),s("div",Fe,[n(x,{type:"button",variant:"ghost",size:"sm",disabled:!a.resumeUrl,onClick:Y},{default:h(()=>[E(g(a.resumeUrl?"Ver CV":"Añade tu CV"),1)]),_:1},8,["disabled"])])]),s("section",Ie,[e[36]||(e[36]=s("header",null,[s("div",null,[s("p",{class:"section-kicker"},"Skills"),s("h3",null,"Haz match según tus fortalezas")])],-1)),s("div",Ae,[e[35]||(e[35]=s("label",null,"Habilidades (separadas por coma)",-1)),n(U,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=o=>P.value=o),placeholder:"Product discovery, UX research"},null,8,["modelValue"])]),F.value.length?(r(),i("div",qe,[(r(!0),i(te,null,re(F.value,o=>(r(),i("span",{key:o},g(o),1))),128))])):f("",!0)]),s("div",Ne,[n(x,{type:"submit","is-loading":H.value},{default:h(()=>[...e[37]||(e[37]=[E("Guardar cambios",-1)])]),_:1},8,["is-loading"]),y.message?(r(),i("p",{key:0,class:m(["feedback",y.type])},g(y.message),3)):f("",!0)])],32)):(r(),i("form",{key:2,class:"profile__panel-stack",onSubmit:D(ee,["prevent"])},[s("section",Le,[e[43]||(e[43]=s("header",null,[s("div",null,[s("p",{class:"section-kicker"},"Ficha de la empresa"),s("h3",null,"Presenta a tu equipo en las vacantes")])],-1)),s("div",Te,[s("div",{class:m(["panel-field",{"has-error":b("name")}])},[e[38]||(e[38]=s("label",null,"Nombre de la empresa",-1)),n(U,{modelValue:t.name,"onUpdate:modelValue":e[12]||(e[12]=o=>t.name=o),placeholder:"Ej. Pulsar Analytics",required:"",onBlur:e[13]||(e[13]=o=>w("name"))},null,8,["modelValue"]),b("name")?(r(),i("small",Oe,"Escribe al menos 2 caracteres.")):f("",!0)],2),s("div",{class:m(["panel-field",{"has-error":b("industry")}])},[e[39]||(e[39]=s("label",null,"Industria",-1)),n(U,{modelValue:t.industry,"onUpdate:modelValue":e[14]||(e[14]=o=>t.industry=o),placeholder:"Data / Impacto",onBlur:e[15]||(e[15]=o=>w("industry"))},null,8,["modelValue"])],2)]),s("div",De,[s("div",{class:m(["panel-field",{"has-error":b("location")}])},[e[40]||(e[40]=s("label",null,"Ubicación",-1)),n(U,{modelValue:t.location,"onUpdate:modelValue":e[16]||(e[16]=o=>t.location=o),placeholder:"Ciudad, País",onBlur:e[17]||(e[17]=o=>w("location"))},null,8,["modelValue"])],2),s("div",{class:m(["panel-field",{"has-error":b("logoUrl")}])},[e[41]||(e[41]=s("label",null,"Logo (URL)",-1)),n(U,{modelValue:t.logoUrl,"onUpdate:modelValue":e[18]||(e[18]=o=>t.logoUrl=o),placeholder:"https://uploads.jobportal.dev/logo.png",onBlur:e[19]||(e[19]=o=>w("logoUrl"))},null,8,["modelValue"]),b("logoUrl")?(r(),i("small",Me,"Usa un enlace válido.")):f("",!0)],2)]),s("div",{class:m(["panel-field",{"has-error":b("description")}])},[e[42]||(e[42]=s("label",null,"Descripción",-1)),M(s("textarea",{"onUpdate:modelValue":e[20]||(e[20]=o=>t.description=o),rows:"4",maxlength:"1500",placeholder:"Cuenta misión, cultura o stack del equipo",onBlur:e[21]||(e[21]=o=>w("description"))},null,544),[[R,t.description]]),b("description")?(r(),i("small",Re,"Máximo 1500 caracteres.")):f("",!0)],2)]),s("div",Ge,[n(x,{type:"submit","is-loading":$.value},{default:h(()=>[...e[44]||(e[44]=[E("Guardar empresa",-1)])]),_:1},8,["is-loading"]),p.message?(r(),i("p",{key:0,class:m(["feedback",p.type])},g(p.message),3)):f("",!0)])],32))]),_:1})])):(r(),oe(q,{key:1,class:"profile__empty-card"},{default:h(()=>[e[47]||(e[47]=s("p",null,"Inicia sesión para personalizar tu experiencia.",-1)),n(x,{onClick:e[22]||(e[22]=o=>A(v).login({email:"demo@uni.edu",password:"demo"}))},{default:h(()=>[...e[46]||(e[46]=[E("Login demo",-1)])]),_:1})]),_:1}))]))}},We=le(He,[["__scopeId","data-v-18687f6d"]]);export{We as default};
