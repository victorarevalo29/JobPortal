import{_ as Y,p as Z,r as N,c as E,s as P,o as j,x as z,a as i,b as a,d as r,w as m,B as U,g as o,h as f,F as b,e as g,l as S,t as l,i as ee,j as _,k as h,n as F,m as q,v as ae,f as te}from"./index-Cw7ty9o7.js";import{B as O}from"./BaseCard-B_bAREMe.js";import{B as C}from"./BaseInput-DF9V6cTV.js";import{u as se}from"./jobsStore-MtEZzHB6.js";import{u as ne}from"./companiesStore-MJg2-nhw.js";const le={class:"manage-jobs"},oe={class:"manage-jobs__header"},ie={class:"manage-jobs__layout"},re={class:"manage-jobs__table"},de={class:"panel-table"},ue={class:"status-pill"},ce={class:"actions"},pe=["onClick"],me=["onClick"],ye={class:"manage-jobs__form"},ve={class:"field"},fe={class:"field"},be={key:0,class:"company-locked"},ge={class:"company-locked__name"},_e=["value"],Ce={class:"field"},ke={class:"field"},Ve=["value"],xe={class:"field"},Me={class:"salary-grid"},Ee=["value"],he={key:0,class:"field__error"},we={class:"field"},Ie={class:"field"},Ue=["value"],Se={class:"job-form__actions"},qe={__name:"ManageJobs",setup(Be){const d=se(),u=ne(),v=Z(),L=[{value:"full-time",label:"Tiempo completo"},{value:"part-time",label:"Medio tiempo"},{value:"contract",label:"Contrato"},{value:"internship",label:"Internship"},{value:"temporary",label:"Temporal"}],A=["USD","MXN","COP","CLP"],$=["draft","active","paused","closed"],w=()=>({id:null,title:"",companyId:"",location:"",contractType:"full-time",salaryMin:"",salaryMax:"",salaryCurrency:"USD",description:"",requiredExperience:"",status:"active"}),s=N(w()),k=E(()=>!!s.id),c=N({description:""}),p=P(""),V=P("success"),I=E(()=>{var e;const n=(e=v.user)==null?void 0:e.company;return n?typeof n=="string"?n:n.id||n._id||"":""}),G=E(()=>{var e;const n=(e=v.user)==null?void 0:e.company;if(!n)return"";if(typeof n=="string"){const t=u.companies.find(y=>y.id===n);return(t==null?void 0:t.name)||""}return n.name||""}),x=E(()=>!!I.value),X=()=>{x.value?s.companyId=I.value:!s.companyId&&u.companies.length&&(s.companyId=u.companies[0].id)},H=n=>{var e,t,y,T,D,R,J;Object.assign(s,w(),{id:n.id,title:n.title,companyId:n.companyId,location:n.location,contractType:n.contractType,salaryMin:((t=(e=n.raw)==null?void 0:e.salaryRange)==null?void 0:t.min)||"",salaryMax:((T=(y=n.raw)==null?void 0:y.salaryRange)==null?void 0:T.max)||"",salaryCurrency:((R=(D=n.raw)==null?void 0:D.salaryRange)==null?void 0:R.currency)||"USD",description:n.description,requiredExperience:((J=n.raw)==null?void 0:J.requiredExperience)||"",status:n.status})},M=()=>{Object.assign(s,w()),X(),c.description="",p.value=""},B=()=>{const n=s.description.trim().length;return n&&n<40?(c.description="Escribe al menos 40 caracteres.",!1):n?(c.description="",!0):(c.description="Describe brevemente el reto y responsabilidades.",!1)},K=()=>B(),Q=async()=>{if(p.value="",V.value="error",!K()||!s.title.trim()||!s.companyId)return;const n={title:s.title.trim(),company:s.companyId,location:s.location.trim(),contractType:s.contractType,description:s.description.trim(),requiredExperience:s.requiredExperience.trim()||void 0,status:s.status,salaryRange:{min:s.salaryMin||void 0,max:s.salaryMax||void 0,currency:s.salaryCurrency}};!n.salaryRange.min&&!n.salaryRange.max&&(n.salaryRange=void 0);try{k.value?(await d.updateJob(s.id,n),V.value="success",p.value="Vacante actualizada"):(await d.createJob(n),V.value="success",p.value="Vacante publicada"),M()}catch(e){p.value=(e==null?void 0:e.message)||d.error||"No se pudo guardar la vacante"}},W=async n=>{await d.deleteJob(n),s.id===n&&M()};return j(async()=>{var n;!((n=v.user)!=null&&n.company)&&v.token&&await v.fetchCurrentUser(),d.jobs.length||await d.fetchJobs({status:void 0}),!x.value&&!u.companies.length&&await u.fetchCompanies()}),z(()=>u.companies.length,n=>{n&&!s.companyId&&!x.value&&(s.companyId=u.companies[0].id)},{immediate:!0}),z(I,n=>{n&&(s.companyId=n)},{immediate:!0}),(n,e)=>(o(),i("section",le,[a("header",oe,[e[11]||(e[11]=a("div",null,[a("p",{class:"section-kicker"},"Vacantes"),a("h1",null,"Publica o edita tus posiciones abiertas."),a("p",null,"Cuenta historias atractivas sobre tu equipo, define expectativas y sincroniza estatus en segundos.")],-1)),r(U,{variant:"ghost",size:"sm",onClick:M},{default:m(()=>[...e[10]||(e[10]=[f("Reiniciar formulario",-1)])]),_:1})]),a("div",ie,[a("section",re,[r(O,null,{title:m(()=>[...e[12]||(e[12]=[f("Vacantes activas",-1)])]),default:m(()=>[a("table",de,[e[13]||(e[13]=a("thead",null,[a("tr",null,[a("th",null,"Título"),a("th",null,"Contrato"),a("th",null,"Ubicación"),a("th",null,"Estado"),a("th")])],-1)),a("tbody",null,[(o(!0),i(b,null,g(S(d).jobs,t=>(o(),i("tr",{key:t.id},[a("td",null,[a("strong",null,l(t.title),1),a("p",null,l(t.company),1)]),a("td",null,l(t.modality),1),a("td",null,l(t.location),1),a("td",null,[a("span",ue,l(t.status),1)]),a("td",ce,[a("button",{class:"table-link",onClick:y=>H(t)},"Editar",8,pe),a("button",{class:"table-link danger",onClick:y=>W(t.id)},"Eliminar",8,me)])]))),128))])])]),_:1})]),a("section",ye,[r(O,null,{title:m(()=>[f(l(k.value?"Actualizar vacante":"Nueva vacante"),1)]),default:m(()=>[a("form",{class:"job-form",onSubmit:ee(Q,["prevent"])},[a("div",ve,[e[14]||(e[14]=a("span",null,"Puesto",-1)),r(C,{modelValue:s.title,"onUpdate:modelValue":e[0]||(e[0]=t=>s.title=t),placeholder:"Ej. Product Designer",required:""},null,8,["modelValue"])]),a("div",fe,[e[17]||(e[17]=a("span",null,"Compañía",-1)),x.value?(o(),i("div",be,[a("p",ge,l(G.value||"Empresa vinculada"),1),e[15]||(e[15]=a("p",{class:"company-locked__hint"},"Se usa la empresa registrada en tu perfil.",-1))])):_((o(),i("select",{key:1,"onUpdate:modelValue":e[1]||(e[1]=t=>s.companyId=t),required:""},[e[16]||(e[16]=a("option",{value:"",disabled:""},"Selecciona una empresa",-1)),(o(!0),i(b,null,g(S(u).companies,t=>(o(),i("option",{key:t.id,value:t.id},l(t.name),9,_e))),128))],512)),[[h,s.companyId]])]),a("div",Ce,[e[18]||(e[18]=a("span",null,"Ubicación",-1)),r(C,{modelValue:s.location,"onUpdate:modelValue":e[2]||(e[2]=t=>s.location=t),placeholder:"Remoto / Ciudad",required:""},null,8,["modelValue"])]),a("div",ke,[e[19]||(e[19]=a("span",null,"Contrato",-1)),_(a("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.contractType=t),required:""},[(o(),i(b,null,g(L,t=>a("option",{key:t.value,value:t.value},l(t.label),9,Ve)),64))],512),[[h,s.contractType]])]),a("div",xe,[e[20]||(e[20]=a("span",null,"Rango salarial",-1)),a("div",Me,[r(C,{modelValue:s.salaryMin,"onUpdate:modelValue":e[4]||(e[4]=t=>s.salaryMin=t),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"Mínimo"},null,8,["modelValue"]),r(C,{modelValue:s.salaryMax,"onUpdate:modelValue":e[5]||(e[5]=t=>s.salaryMax=t),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"Máximo"},null,8,["modelValue"]),_(a("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>s.salaryCurrency=t)},[(o(),i(b,null,g(A,t=>a("option",{key:t,value:t},l(t),9,Ee)),64))],512),[[h,s.salaryCurrency]])])]),a("div",{class:F(["field",{"has-error":c.description}])},[e[21]||(e[21]=a("span",null,"Descripción corta",-1)),_(a("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>s.description=t),rows:"4",placeholder:"Comparte contexto sobre el reto",onBlur:B},null,544),[[ae,s.description]]),c.description?(o(),i("small",he,l(c.description),1)):q("",!0)],2),a("div",we,[e[22]||(e[22]=a("span",null,"Experiencia requerida",-1)),r(C,{modelValue:s.requiredExperience,"onUpdate:modelValue":e[8]||(e[8]=t=>s.requiredExperience=t),placeholder:"3+ años liderando squads"},null,8,["modelValue"])]),a("div",Ie,[e[23]||(e[23]=a("span",null,"Estado",-1)),_(a("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>s.status=t)},[(o(),i(b,null,g($,t=>a("option",{key:t,value:t},l(t),9,Ue)),64))],512),[[h,s.status]])]),a("div",Se,[r(U,{type:"submit","is-loading":S(d).saving},{default:m(()=>[f(l(k.value?"Guardar cambios":"Publicar vacante"),1)]),_:1},8,["is-loading"]),k.value?(o(),te(U,{key:0,variant:"ghost",type:"button",onClick:M},{default:m(()=>[...e[24]||(e[24]=[f("Cancelar",-1)])]),_:1})):q("",!0),p.value?(o(),i("p",{key:1,class:F(["job-form__feedback",V.value])},l(p.value),3)):q("",!0)])],32)]),_:1})])])]))}},Pe=Y(qe,[["__scopeId","data-v-4916d1a4"]]);export{Pe as default};
