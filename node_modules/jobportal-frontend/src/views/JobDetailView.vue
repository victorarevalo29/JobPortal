<template>
  <section class="job-detail" v-if="job">
    <div class="job-detail__header">
      <BaseButton variant="ghost" size="sm" @click="goBack">← Volver</BaseButton>
      <span class="job-detail__badge">{{ job.modality || 'Flexible' }}</span>
    </div>
    <div class="job-detail__layout">
      <article class="job-detail__content">
        <BaseCard variant="glass">
          <template #title>{{ job.title }}</template>
          <p class="job-detail__company">{{ job.company }} · {{ job.location }}</p>
          <p class="job-detail__salary">{{ job.salaryRange || job.salary }}</p>
          <div class="job-detail__meta">
            <div>
              <small>Nivel</small>
              <strong>{{ job.seniority || 'Intermedio' }}</strong>
            </div>
            <div>
              <small>Publicado</small>
              <strong>{{ job.postedAgo || 'Hoy' }}</strong>
            </div>
            <div>
              <small>Horario</small>
              <strong>{{ job.schedule || 'Tiempo completo' }}</strong>
            </div>
            <div>
              <small>Aplicaciones</small>
              <strong>{{ applicationCountLabel }}</strong>
            </div>
          </div>
          <section class="job-detail__section">
            <h3>Descripción</h3>
            <p>
              {{ job.description || 'Experimenta con desafíos reales: iteraciones con stakeholders, research vivo y acceso a frameworks exclusivos.' }}
            </p>
          </section>
          <section class="job-detail__section">
            <h3>Requerimientos</h3>
            <ul>
              <li v-for="requirement in requirements" :key="requirement">{{ requirement }}</li>
            </ul>
          </section>
          <section class="job-detail__section">
            <h3>Skills</h3>
            <ul class="job-detail__skills">
              <li v-for="skill in (job.skills || placeholderSkills)" :key="skill">{{ skill }}</li>
            </ul>
          </section>
          <div class="job-detail__apply">
            <div class="job-detail__apply-form">
              <label>
                <span>Mensaje para el empleador</span>
                <textarea
                  v-model="applicationForm.message"
                  rows="4"
                  placeholder="Haz match explicando tu interés y disponibilidad"
                ></textarea>
              </label>
              <label class="job-detail__file-input">
                <span>Adjunta tu CV (PDF o DOC, máx. 5 MB)</span>
                <input type="file" accept=".pdf,.doc,.docx" @change="handleCvSelection" />
              </label>
              <p v-if="applicationForm.cvPreview" class="job-detail__file-pill">
                {{ applicationForm.cvPreview }}
                <button type="button" @click="clearCvSelection">Quitar</button>
              </p>
            </div>
            <BaseButton
              size="lg"
              :is-loading="applyState.loading"
              :disabled="alreadyApplied || applyState.loading || isOwnJob"
              @click="openApplicationReview"
            >
              {{ alreadyApplied ? 'Ya postulaste' : 'Aplicar ahora' }}
            </BaseButton>
            <p class="job-detail__applications-chip">
              {{ applicationCountLabel }} · comunidad JobPortal
            </p>
            <p v-if="isOwnJob" class="job-detail__status job-detail__status--error">
              Esta vacante pertenece a tu empresa, no puedes postularte.
            </p>
            <p v-if="applyState.error" class="job-detail__status job-detail__status--error">{{ applyState.error }}</p>
ñ            <p v-if="applyState.success" class="job-detail__status" aria-live="polite">
              Tu postulación fue enviada. Redirigiéndote a Mis aplicaciones…
            </p>
          </div>
        </BaseCard>
      </article>
      <aside class="job-detail__sidebar">
        <BaseCard>
          <template #title>Sobre la empresa</template>
          <p class="job-detail__company-info">{{ companyInfo.summary }}</p>
          <ul class="job-detail__facts">
            <li>
              <span>Equipo</span>
              <strong>{{ companyInfo.size }}</strong>
            </li>
            <li>
              <span>Headquarters</span>
              <strong>{{ companyInfo.hq }}</strong>
            </li>
            <li>
              <span>Industria</span>
              <strong>{{ companyInfo.industry }}</strong>
            </li>
          </ul>
        </BaseCard>
        <BaseCard>
          <template #title>Valoraciones</template>
          <div class="job-detail__ratings">
            <div>
              <p class="job-detail__rating-score">{{ averageRatingText }}</p>
              <small>{{ totalReviews }} reseñas</small>
            </div>
            <div class="job-detail__stars">
              <span
                v-for="star in 5"
                :key="star"
                :class="['star', { 'star--active': star <= Math.round(averageRatingValue) }]"
              ></span>
            </div>
          </div>
        </BaseCard>
      </aside>
    </div>
    <section class="job-detail__comments">
      <header>
        <div>
          <p class="section-kicker">Feedback de cohorts</p>
          <h3>Lo que dice la comunidad.</h3>
        </div>
        <div class="job-detail__review-form">
          <label>
            <span>Valoración</span>
            <select v-model.number="reviewForm.rating">
              <option v-for="rating in [5, 4, 3, 2, 1]" :key="rating" :value="rating">{{ rating }} / 5</option>
            </select>
          </label>
          <textarea v-model="reviewForm.comment" placeholder="Comparte tu experiencia con este equipo" rows="3"></textarea>
            <BaseButton size="sm" :is-loading="reviewState.loading" @click="submitReview">Publicar</BaseButton>
            <p v-if="reviewState.error" class="job-detail__status job-detail__status--error">{{ reviewState.error }}</p>
        </div>
      </header>
      <ul class="job-detail__review-list">
        <li v-for="review in reviews" :key="review.id" class="review-card">
          <div class="review-card__header">
            <strong>{{ review.author }}</strong>
            <span>{{ formatDate(review.date) }}</span>
          </div>
          <div class="review-card__rating">
            <span v-for="star in 5" :key="star" :class="['star', { 'star--active': star <= review.rating }]"></span>
            <small>{{ review.rating }}/5</small>
          </div>
          <p>{{ review.comment }}</p>
        </li>
      </ul>
    </section>
  </section>
  <section v-else class="job-detail job-detail--empty">
    <BaseCard>
      <template #title>Selecciona una vacante</template>
      <p>Explora el radar y elige un rol para ver los detalles.</p>
    </BaseCard>
  </section>
  <Teleport to="body">
    <div v-if="showApplicationReview" class="job-detail__modal" role="dialog" aria-modal="true">
      <div class="application-review">
        <header class="application-review__header">
          <div>
            <p class="application-review__eyebrow">Confirmar postulación</p>
            <h3>Envía tu perfil con confianza</h3>
            <p>Verifica que los datos coincidan antes de compartirlos con {{ job?.company }}.</p>
          </div>
          <button type="button" class="application-review__close" aria-label="Cerrar" @click="closeApplicationReview">
            &times;
          </button>
        </header>
        <div class="application-review__grid">
          <section class="application-review__card">
            <p class="application-review__label">Vacante</p>
            <p class="application-review__title">{{ job?.title }}</p>
            <p class="application-review__subtitle">{{ job?.company }} · {{ job?.location }}</p>
            <ul class="application-review__meta">
              <li>
                <span>Modalidad</span>
                <strong>{{ job?.modality || 'Flexible' }}</strong>
              </li>
              <li>
                <span>Aplicaciones</span>
                <strong>{{ applicationCountLabel }}</strong>
              </li>
            </ul>
          </section>
          <section class="application-review__card">
            <p class="application-review__label">Candidato</p>
            <p class="application-review__title">{{ authStore.user?.name }}</p>
            <p class="application-review__subtitle">{{ authStore.user?.email }}</p>
            <ul class="application-review__meta">
              <li>
                <span>Mensaje</span>
                <strong>{{ applicationForm.message?.trim() ? 'Personalizado' : 'Sin mensaje' }}</strong>
              </li>
              <li>
                <span>CV</span>
                <strong>{{ applicationForm.cvPreview ? 'Adjunto' : 'Pendiente' }}</strong>
              </li>
            </ul>
          </section>
        </div>
        <section class="application-review__details">
          <article>
            <p class="application-review__label">Mensaje al empleador</p>
            <p>{{ applicationForm.message?.trim() || 'Sin mensaje adicional' }}</p>
          </article>
          <article>
            <p class="application-review__label">CV adjunto</p>
            <p>{{ applicationForm.cvPreview || 'No adjuntaste archivo' }}</p>
          </article>
        </section>
        <footer class="application-review__actions">
          <p class="application-review__hint">Tip: un mensaje breve y un CV actualizado elevan tus probabilidades.</p>
          <div class="application-review__buttons">
            <BaseButton variant="ghost" size="sm" :disabled="applyState.loading" @click="closeApplicationReview">
              Seguir editando
            </BaseButton>
            <BaseButton size="sm" :is-loading="applyState.loading" @click="submitApplication">
              Enviar postulación
            </BaseButton>
          </div>
        </footer>
      </div>
    </div>
  </Teleport>
  <!-- Success modal removed: redirect happens programmatically -->
</template>

<script setup>
import { computed, onUnmounted, reactive, ref, watch } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import BaseCard from '@/components/BaseCard.vue'
import BaseButton from '@/components/BaseButton.vue'
import { useJobsStore } from '@/stores/jobsStore'
import { useAuthStore } from '@/stores/authStore'
import { apiRequest } from '@/services/httpClient'

const props = defineProps({
  id: {
    type: String,
    default: ''
  }
})

const route = useRoute()
const router = useRouter()
const jobsStore = useJobsStore()
const authStore = useAuthStore()
const resolvedJobId = computed(() => props.id || route.params.id)

const placeholderSkills = ['OKRs', 'Figma', 'Notion', 'User interviews']
const placeholderRequirements = [
  'Disponibilidad para colaborar 15 horas semanales en ciclos ágiles.',
  'Documentar hallazgos en Notion y presentar recap semanal.',
  'Nivel conversacional de inglés para syncs con mentores globales.'
]
const mapCompanyReview = (review) => ({
  id: review._id || review.id,
  author: review.author?.name || 'Talento JobPortal',
  rating: Number(review.rating || 0),
  comment: review.comment || 'Sin comentario adicional',
  date: review.publishedAt || review.createdAt || new Date().toISOString()
})

const job = computed(() => jobsStore.selectedJob)
const activeJobId = computed(() => job.value?.id || resolvedJobId.value || '')
const requirements = computed(() => (job.value?.requirements?.length ? job.value.requirements : placeholderRequirements))

const companyInfo = computed(() => ({
  summary:
    job.value?.companySummary ||
    'Startup enfocada en crear experiencias data-informed para escalar productos con cohorts universitarios.',
  size: job.value?.companySize || '50 - 80 personas',
  hq: job.value?.companyHq || 'CDMX · Remote first',
  industry: job.value?.industry || 'Producto digital'
}))

const applyState = reactive({ loading: false, error: '', success: false })
const alreadyApplied = ref(false)
const applicationCount = ref(0)
const showApplicationReview = ref(false)
const successRedirectTimer = ref(null)
const reviews = ref([])
const reviewsLoading = ref(false)
const reviewForm = reactive({ rating: 5, comment: '' })
const reviewState = reactive({ loading: false, error: '' })
const applicationForm = reactive({ message: '', cvFile: null, cvPreview: '' })

const authUserId = computed(() => authStore.user?._id || authStore.user?.id)
const applicationCountLabel = computed(() => {
  const total = applicationCount.value
  if (total === 1) return '1 postulación'
  return `${total} postulaciones`
})
const employerCompanyId = computed(() => authStore.user?.company?._id || authStore.user?.company?.id || null)
const isOwnJob = computed(() => {
  if (!job.value?.companyId) return false
  return authStore.user?.role === 'employer' && employerCompanyId.value === job.value.companyId
})

const fetchCompanyReviews = async (companyId) => {
  if (!companyId) {
    reviews.value = []
    return
  }
  reviewsLoading.value = true
  try {
    const data = await apiRequest('/reviews', { params: { company: companyId } })
    reviews.value = Array.isArray(data) ? data.map(mapCompanyReview) : []
  } catch (error) {
    reviews.value = []
  } finally {
    reviewsLoading.value = false
  }
}

const markApplicationStatus = async () => {
  const jobId = activeJobId.value
  if (!authStore.isAuthenticated || !jobId) {
    alreadyApplied.value = false
    return
  }
  try {
    const data = await apiRequest('/applications', { params: { job: jobId }, auth: true })
    if (!Array.isArray(data)) {
      return
    }
    applicationCount.value = data.length
    const currentUserId = authUserId.value
    alreadyApplied.value = data.some((application) => {
      const candidateId = application.candidate?._id || application.candidate
      return candidateId === currentUserId
    })
  } catch (error) {
    alreadyApplied.value = false
    applicationCount.value = 0
  }
}

watch(job, (value) => {
  if (!value) return
  applyState.success = false
  alreadyApplied.value = false
  showApplicationReview.value = false
  reviewState.error = ''
  applicationCount.value = Number(value.applicationsCount) || 0
  fetchCompanyReviews(value.companyId)
  markApplicationStatus()
  resetApplicationForm()
})

watch(
  () => reviewForm.comment,
  () => {
    if (reviewState.error) {
      reviewState.error = ''
    }
  }
)

const averageRatingValue = computed(() => {
  if (!reviews.value.length) return 0
  const sum = reviews.value.reduce((acc, review) => acc + Number(review.rating || 0), 0)
  return sum / reviews.value.length
})

const averageRatingText = computed(() => averageRatingValue.value.toFixed(1))
const totalReviews = computed(() => reviews.value.length)

const resetApplicationForm = () => {
  applicationForm.message = ''
  applicationForm.cvFile = null
  applicationForm.cvPreview = ''
}

const redirectToApplications = () => {
  if (successRedirectTimer.value) {
    clearTimeout(successRedirectTimer.value)
    successRedirectTimer.value = null
  }
  router.push('/applications/my')
}

const scheduleApplicationsRedirect = () => {
  if (typeof window === 'undefined') {
    redirectToApplications()
    return
  }
  if (successRedirectTimer.value) {
    clearTimeout(successRedirectTimer.value)
  }
  successRedirectTimer.value = window.setTimeout(() => {
    redirectToApplications()
  }, 2200)
}

const handleSuccessfulApplication = () => {
  alreadyApplied.value = true
  applyState.success = true
  applicationCount.value += 1
  scheduleApplicationsRedirect()
}

const clearCvSelection = (event) => {
  if (event?.target) {
    event.target.value = ''
  }
  applicationForm.cvFile = null
  applicationForm.cvPreview = ''
}

const handleCvSelection = (event) => {
  const file = event.target.files?.[0]
  if (!file) {
    clearCvSelection(event)
    return
  }

  const maxSize = 5 * 1024 * 1024
  const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document']

  if (file.size > maxSize) {
    applyState.error = 'El CV debe pesar máximo 5 MB'
    event.target.value = ''
    return
  }

  if (!allowedTypes.includes(file.type)) {
    applyState.error = 'Solo se permiten archivos PDF o Word'
    event.target.value = ''
    return
  }

  applyState.error = ''
  applicationForm.cvFile = file
  applicationForm.cvPreview = file.name
}

const openApplicationReview = () => {
  if (!authStore.isAuthenticated) {
    router.push({ name: 'login', query: { redirect: route.fullPath } })
    return
  }
  if (!activeJobId.value || alreadyApplied.value || applyState.loading || isOwnJob.value) return
  applyState.error = ''
  showApplicationReview.value = true
}

const closeApplicationReview = () => {
  if (applyState.loading) return
  showApplicationReview.value = false
}

const buildApplicationPayload = () => {
  const jobId = activeJobId.value
  if (!jobId) {
    throw new Error('Vacante no disponible')
  }

  const formData = new FormData()
  const trimmedMessage = applicationForm.message.trim()
  formData.append('job', jobId)
  if (trimmedMessage) {
    formData.append('message', trimmedMessage)
  }
  if (applicationForm.cvFile) {
    formData.append('cvFile', applicationForm.cvFile)
  }
  return formData
}

const submitApplication = async () => {
  if (!activeJobId.value || alreadyApplied.value || applyState.loading || isOwnJob.value) return

  let payload
  try {
    payload = buildApplicationPayload()
  } catch (error) {
    applyState.error = error.message || 'Vacante no disponible'
    return
  }

  showApplicationReview.value = false
  applyState.loading = true
  applyState.error = ''
  try {
    const response = await apiRequest('/applications', {
      method: 'POST',
      data: payload,
      auth: true
    })
    handleSuccessfulApplication()
    resetApplicationForm()
    markApplicationStatus()
    if (response?.stats) {
      authStore.setSession({
        user: {
          ...authStore.user,
          stats: response.stats
        }
      })
    }
  } catch (error) {
    applyState.error = error.message || 'No pudimos registrar tu postulación'
  } finally {
    applyState.loading = false
  }
}

onUnmounted(() => {
  if (successRedirectTimer.value) {
    clearTimeout(successRedirectTimer.value)
    successRedirectTimer.value = null
  }
})

const submitReview = async () => {
  if (!authStore.isAuthenticated) {
    router.push({ name: 'login', query: { redirect: route.fullPath } })
    return
  }

  const companyId = job.value?.companyId
  const authorId = authUserId.value
  if (!companyId || !authorId) {
    reviewState.error = 'No podemos vincular tu valoración con esta empresa.'
    return
  }

  const trimmedComment = reviewForm.comment.trim()
  if (!trimmedComment) {
    reviewState.error = 'Comparte un breve comentario para la empresa.'
    return
  }

  reviewState.loading = true
  reviewState.error = ''
  try {
    const created = await apiRequest('/reviews', {
      method: 'POST',
      data: {
        company: companyId,
        author: authorId,
        rating: reviewForm.rating,
        comment: trimmedComment
      },
      auth: true
    })
    const mappedReview = mapCompanyReview(created)
    reviews.value = [mappedReview, ...reviews.value.filter((review) => review.id !== mappedReview.id)]
    reviewForm.comment = ''
  } catch (error) {
    reviewState.error = error.message || 'No pudimos registrar tu valoración'
  } finally {
    reviewState.loading = false
  }
}

const formatDate = (value) => {
  if (!value) return 'Reciente'
  const date = new Date(value)
  return date.toLocaleDateString('es-MX', { month: 'short', day: 'numeric' })
}

const goBack = () => {
  router.back()
}

const loadJob = async (id) => {
  if (!id) return
  await jobsStore.fetchJobById(id)
}

watch(
  resolvedJobId,
  (id) => {
    if (id) {
      loadJob(id)
    }
  },
  { immediate: true }
)
</script>

<style scoped>
.job-detail {
  padding: 3rem 0 4rem;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.job-detail__layout {
  display: grid;
  grid-template-columns: minmax(0, 2fr) minmax(280px, 1fr);
  gap: 1.5rem;
}

.job-detail__content {
  min-width: 0;
}

.job-detail__sidebar {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.job-detail__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.job-detail__badge {
  padding: 0.35rem 1rem;
  border-radius: 999px;
  background: rgba(37, 99, 235, 0.15);
  color: var(--clr-primary);
  font-weight: 600;
}

.job-detail__company {
  font-weight: 600;
  color: var(--clr-muted);
}

.job-detail__salary {
  font-weight: 700;
  color: var(--clr-secondary);
  font-size: 1.4rem;
}

.job-detail__meta {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 1rem;
  margin: 1rem 0 1.5rem;
}

.job-detail__meta small {
  text-transform: uppercase;
  font-size: 0.75rem;
  letter-spacing: 0.15em;
  color: var(--clr-muted);
}

.job-detail__skills {
  list-style: none;
  padding: 0;
  margin: 1.25rem 0;
  display: flex;
  flex-wrap: wrap;
  gap: 0.6rem;
}

.job-detail__skills li {
  padding: 0.4rem 1rem;
  border-radius: 999px;
  border: 1px solid rgba(37, 99, 235, 0.2);
}

.job-detail__section {
  margin: 1.5rem 0;
}

.job-detail__section h3 {
  margin: 0 0 0.6rem;
}

.job-detail__section ul {
  padding-left: 1.2rem;
  color: var(--clr-muted);
}

.job-detail__apply {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.job-detail__apply-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 0.5rem;
}

.job-detail__apply-form label {
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  font-weight: 600;
}

.job-detail__apply-form textarea {
  border-radius: var(--radius-lg);
  border: 1px solid var(--clr-border);
  padding: 0.85rem 1rem;
  font-family: inherit;
  resize: vertical;
}

.job-detail__file-input input[type='file'] {
  border: 1px dashed rgba(37, 99, 235, 0.4);
  border-radius: var(--radius-lg);
  padding: 0.7rem;
  cursor: pointer;
}

.job-detail__file-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.35rem 0.9rem;
  border-radius: 999px;
  background: rgba(37, 99, 235, 0.12);
  font-size: 0.9rem;
  width: fit-content;
}

.job-detail__file-pill button {
  border: none;
  background: none;
  color: var(--clr-primary);
  font-weight: 600;
  cursor: pointer;
}

.job-detail__status {
  margin: 0;
  font-weight: 600;
  color: var(--clr-primary);
}

.job-detail__status--error {
  color: #dc2626;
}

.job-detail__company-info {
  color: var(--clr-muted);
}

.job-detail__facts {
  list-style: none;
  padding: 0;
  margin: 1rem 0 0;
  display: grid;
  gap: 0.5rem;
}

.job-detail__facts li {
  display: flex;
  justify-content: space-between;
  font-weight: 600;
}

.job-detail__ratings {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.job-detail__rating-score {
  margin: 0;
  font-size: 2.5rem;
  font-family: var(--font-heading);
}

.job-detail__stars {
  display: flex;
  gap: 0.25rem;
}

.star {
  width: 18px;
  height: 18px;
  border-radius: 4px;
  background: rgba(15, 23, 42, 0.1);
}

.star--active {
  background: linear-gradient(135deg, var(--clr-primary), var(--clr-accent));
}

.job-detail__comments {
  background: var(--clr-surface);
  border-radius: var(--radius-xl);
  padding: 2rem;
  box-shadow: var(--shadow-card);
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.job-detail__comments header {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.job-detail__review-form {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 0.8rem;
}

.job-detail__review-form textarea,
.job-detail__review-form select {
  border-radius: 1rem;
  border: 1px solid var(--clr-border);
  padding: 0.9rem 1rem;
  background: var(--clr-bg-muted);
  font-family: inherit;
}

.job-detail__review-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: 1rem;
}

.review-card {
  border: 1px solid rgba(37, 99, 235, 0.14);
  border-radius: var(--radius-md);
  padding: 1.25rem;
  background: var(--clr-surface-alt);
}

.review-card__header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.35rem;
}

.review-card__rating {
  display: flex;
  gap: 0.4rem;
  align-items: center;
  color: var(--clr-muted);
}

.job-detail--empty {
  opacity: 0.85;
}

.job-detail__modal {
  position: fixed;
  inset: 0;
  background: rgba(10, 18, 41, 0.65);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1.5rem;
  z-index: 90;
}

.application-review {
  width: min(860px, 100%);
  background: var(--clr-surface);
  border-radius: calc(var(--radius-xl) * 0.9);
  box-shadow: 0 30px 60px rgba(15, 23, 42, 0.25);
  padding: 2.5rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.application-review__header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1rem;
}

.application-review__eyebrow {
  text-transform: uppercase;
  letter-spacing: 0.18em;
  font-size: 0.75rem;
  color: var(--clr-muted);
  margin-bottom: 0.4rem;
}

.application-review__header h3 {
  margin: 0;
}

.application-review__header p {
  margin: 0.35rem 0 0;
  color: var(--clr-muted);
}

.application-review__close {
  border: none;
  background: rgba(15, 23, 42, 0.06);
  border-radius: 999px;
  width: 36px;
  height: 36px;
  font-size: 1.2rem;
  cursor: pointer;
  line-height: 1;
  color: var(--clr-text);
}

.application-review__grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1rem;
}

.application-review__card {
  border: 1px solid var(--clr-border);
  border-radius: var(--radius-lg);
  padding: 1.25rem;
  background: var(--clr-surface-alt);
}

.application-review__label {
  text-transform: uppercase;
  font-size: 0.75rem;
  letter-spacing: 0.15em;
  color: var(--clr-muted);
  margin: 0 0 0.35rem;
}

.application-review__title {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 700;
}

.application-review__subtitle {
  margin: 0.15rem 0 0.8rem;
  color: var(--clr-muted);
}

.application-review__meta {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  gap: 0.6rem;
}

.application-review__meta span {
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--clr-muted);
}

.application-review__meta strong {
  display: block;
  font-size: 0.95rem;
}

.application-review__details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 1rem;
}

.application-review__details article {
  border: 1px dashed rgba(37, 99, 235, 0.25);
  border-radius: var(--radius-lg);
  padding: 1rem 1.25rem;
  background: rgba(37, 99, 235, 0.04);
}

.application-review__details p {
  margin: 0;
  color: var(--clr-text);
}

.application-review__actions {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
}

.application-review__hint {
  margin: 0;
  color: var(--clr-muted);
}

.application-review__buttons {
  display: flex;
  gap: 0.75rem;
}

@media (max-width: 960px) {
  .job-detail__layout {
    grid-template-columns: 1fr;
  }

  .job-detail__sidebar {
    flex-direction: row;
    flex-wrap: wrap;
  }

  .application-review {
    padding: 1.5rem;
  }

  .application-review__header {
    flex-direction: column;
  }

  .application-review__buttons {
    width: 100%;
    justify-content: flex-end;
    flex-wrap: wrap;
  }
}
</style>
