import{D as h,z as i}from"./index-Cw7ty9o7.js";const c=t=>{if(!t)return"Reciente";const e=new Date(t);if(Number.isNaN(e.getTime()))return"Reciente";const r=Math.floor((Date.now()-e.getTime())/(1e3*60));if(r<1)return"Justo ahora";if(r<60)return`Hace ${r} min`;const a=Math.floor(r/60);return a<24?`Hace ${a} h`:`Hace ${Math.floor(a/24)} d`},u=t=>{var e,r,a,s;return{id:t._id||((r=(e=globalThis.crypto)==null?void 0:e.randomUUID)==null?void 0:r.call(e))||`comment-${Date.now()}`,author:((a=t.author)==null?void 0:a.name)||"Participante",authorRole:(s=t.author)==null?void 0:s.role,content:t.content,date:c(t.createdAt)}},n=t=>{var e,r,a,s,o;return{id:t._id,category:t.category,title:t.title,author:((e=t.author)==null?void 0:e.name)||"Comunidad JobPortal",authorRole:(r=t.author)==null?void 0:r.role,preview:((a=t.content)==null?void 0:a.slice(0,180))||"",replies:((s=t.comments)==null?void 0:s.length)||0,lastActivity:c(t.updatedAt||t.createdAt),status:(o=t.comments)!=null&&o.length?"Con actividad":"Nuevo",focus:[t.category],comments:(t.comments||[]).map(u).reverse(),raw:t}},d=h("forum",{state:()=>({threads:[],selectedThread:null,loading:!1,error:""}),actions:{async fetchThreads(t={}){this.loading=!0,this.error="";try{const e=await i("/forum",{params:t});this.threads=Array.isArray(e)?e.map(n):[]}catch(e){this.error=e.message,this.threads=[]}finally{this.loading=!1}},async selectThread(t){if(!t){this.selectedThread=null;return}this.loading=!0,this.error="";try{const e=await i(`/forum/${t}`);this.selectedThread=n(e)}catch(e){this.error=e.message,this.selectedThread=null}finally{this.loading=!1}},async createThread(t,e={}){this.loading=!0,this.error="";try{const r=await i("/forum",{method:"POST",data:t,auth:!0}),a=n(r);return Array.isArray(e.focus)&&e.focus.length&&(a.focus=e.focus),this.threads=[a,...this.threads],a}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async addComment(t,e){var r;if(t){this.error="";try{const a=await i(`/forum/${t}/comments`,{method:"POST",data:e,auth:!0}),s=n(a);return this.threads=this.threads.map(o=>o.id===t?s:o),((r=this.selectedThread)==null?void 0:r.id)===t&&(this.selectedThread=s),s}catch(a){throw this.error=a.message,a}}}}});export{d as u};
