import{_ as xe,p as Pe,c as _,q as Re,r as q,s as S,x as E,y as Ve,a as d,f as Fe,b as a,d as h,w as p,B as V,t as l,j as U,m as A,k as Ie,F as C,e as x,v as oe,l as ie,T as Te,u as ze,g as r,h as b,n as ne,z as N}from"./index-Cw7ty9o7.js";import{B}from"./BaseCard-B_bAREMe.js";import{u as De}from"./jobsStore-MtEZzHB6.js";const qe={key:0,class:"job-detail"},Ne={class:"job-detail__header"},Be={class:"job-detail__badge"},Me={class:"job-detail__layout"},Je={class:"job-detail__content"},Ee={class:"job-detail__company"},Ue={class:"job-detail__salary"},Oe={class:"job-detail__meta"},He={class:"job-detail__section"},Le={class:"job-detail__section"},Xe={class:"job-detail__section"},Ke={class:"job-detail__skills"},Qe={class:"job-detail__apply"},We={class:"job-detail__apply-form"},Ye={class:"job-detail__file-input"},$e={key:0,class:"job-detail__file-pill"},Ge={class:"job-detail__applications-chip"},Ze={key:0,class:"job-detail__status job-detail__status--error"},ea={key:1,class:"job-detail__status job-detail__status--error"},aa={key:2,class:"job-detail__status","aria-live":"polite"},ta={class:"job-detail__sidebar"},la={class:"job-detail__company-info"},sa={class:"job-detail__facts"},oa={class:"job-detail__ratings"},ia={class:"job-detail__rating-score"},na={class:"job-detail__stars"},ra={class:"job-detail__comments"},ua={class:"job-detail__review-form"},da=["value"],ca={key:0,class:"job-detail__status job-detail__status--error"},pa={class:"job-detail__review-list"},va={class:"review-card__header"},ma={class:"review-card__rating"},_a={key:1,class:"job-detail job-detail--empty"},ba={key:0,class:"job-detail__modal",role:"dialog","aria-modal":"true"},fa={class:"application-review"},ga={class:"application-review__header"},ya={class:"application-review__grid"},wa={class:"application-review__card"},ha={class:"application-review__title"},ja={class:"application-review__subtitle"},ka={class:"application-review__meta"},Ca={class:"application-review__card"},Sa={class:"application-review__title"},Aa={class:"application-review__subtitle"},xa={class:"application-review__meta"},Pa={class:"application-review__details"},Ra={class:"application-review__actions"},Va={class:"application-review__buttons"},Fa={__name:"JobDetailView",props:{id:{type:String,default:""}},setup(re){const ue=re,M=Re(),F=ze(),O=De(),v=Pe(),H=_(()=>ue.id||M.params.id),de=["OKRs","Figma","Notion","User interviews"],ce=["Disponibilidad para colaborar 15 horas semanales en ciclos ágiles.","Documentar hallazgos en Notion y presentar recap semanal.","Nivel conversacional de inglés para syncs con mentores globales."],L=t=>{var e;return{id:t._id||t.id,author:((e=t.author)==null?void 0:e.name)||"Talento JobPortal",rating:Number(t.rating||0),comment:t.comment||"Sin comentario adicional",date:t.publishedAt||t.createdAt||new Date().toISOString()}},s=_(()=>O.selectedJob),I=_(()=>{var t;return((t=s.value)==null?void 0:t.id)||H.value||""}),pe=_(()=>{var t,e;return(e=(t=s.value)==null?void 0:t.requirements)!=null&&e.length?s.value.requirements:ce}),T=_(()=>{var t,e,n,c;return{summary:((t=s.value)==null?void 0:t.companySummary)||"Startup enfocada en crear experiencias data-informed para escalar productos con cohorts universitarios.",size:((e=s.value)==null?void 0:e.companySize)||"50 - 80 personas",hq:((n=s.value)==null?void 0:n.companyHq)||"CDMX · Remote first",industry:((c=s.value)==null?void 0:c.industry)||"Producto digital"}}),i=q({loading:!1,error:"",success:!1}),y=S(!1),P=S(0),R=S(!1),w=S(null),f=S([]),X=S(!1),j=q({rating:5,comment:""}),m=q({loading:!1,error:""}),u=q({message:"",cvFile:null,cvPreview:""}),K=_(()=>{var t,e;return((t=v.user)==null?void 0:t._id)||((e=v.user)==null?void 0:e.id)}),J=_(()=>{const t=P.value;return t===1?"1 postulación":`${t} postulaciones`}),ve=_(()=>{var t,e,n,c;return((e=(t=v.user)==null?void 0:t.company)==null?void 0:e._id)||((c=(n=v.user)==null?void 0:n.company)==null?void 0:c.id)||null}),z=_(()=>{var t,e;return(t=s.value)!=null&&t.companyId?((e=v.user)==null?void 0:e.role)==="employer"&&ve.value===s.value.companyId:!1}),me=async t=>{if(!t){f.value=[];return}X.value=!0;try{const e=await N("/reviews",{params:{company:t}});f.value=Array.isArray(e)?e.map(L):[]}catch{f.value=[]}finally{X.value=!1}},Q=async()=>{const t=I.value;if(!v.isAuthenticated||!t){y.value=!1;return}try{const e=await N("/applications",{params:{job:t},auth:!0});if(!Array.isArray(e))return;P.value=e.length;const n=K.value;y.value=e.some(c=>{var k;return(((k=c.candidate)==null?void 0:k._id)||c.candidate)===n})}catch{y.value=!1,P.value=0}};E(s,t=>{t&&(i.success=!1,y.value=!1,R.value=!1,m.error="",P.value=Number(t.applicationsCount)||0,me(t.companyId),Q(),Y())}),E(()=>j.comment,()=>{m.error&&(m.error="")});const W=_(()=>f.value.length?f.value.reduce((e,n)=>e+Number(n.rating||0),0)/f.value.length:0),_e=_(()=>W.value.toFixed(1)),be=_(()=>f.value.length),Y=()=>{u.message="",u.cvFile=null,u.cvPreview=""},$=()=>{w.value&&(clearTimeout(w.value),w.value=null),F.push("/applications/my")},fe=()=>{if(typeof window>"u"){$();return}w.value&&clearTimeout(w.value),w.value=window.setTimeout(()=>{$()},2200)},ge=()=>{y.value=!0,i.success=!0,P.value+=1,fe()},G=t=>{t!=null&&t.target&&(t.target.value=""),u.cvFile=null,u.cvPreview=""},ye=t=>{var g;const e=(g=t.target.files)==null?void 0:g[0];if(!e){G(t);return}const n=5*1024*1024,c=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e.size>n){i.error="El CV debe pesar máximo 5 MB",t.target.value="";return}if(!c.includes(e.type)){i.error="Solo se permiten archivos PDF o Word",t.target.value="";return}i.error="",u.cvFile=e,u.cvPreview=e.name},we=()=>{if(!v.isAuthenticated){F.push({name:"login",query:{redirect:M.fullPath}});return}!I.value||y.value||i.loading||z.value||(i.error="",R.value=!0)},Z=()=>{i.loading||(R.value=!1)},he=()=>{const t=I.value;if(!t)throw new Error("Vacante no disponible");const e=new FormData,n=u.message.trim();return e.append("job",t),n&&e.append("message",n),u.cvFile&&e.append("cvFile",u.cvFile),e},je=async()=>{if(!I.value||y.value||i.loading||z.value)return;let t;try{t=he()}catch(e){i.error=e.message||"Vacante no disponible";return}R.value=!1,i.loading=!0,i.error="";try{const e=await N("/applications",{method:"POST",data:t,auth:!0});ge(),Y(),Q(),e!=null&&e.stats&&v.setSession({user:{...v.user,stats:e.stats}})}catch(e){i.error=e.message||"No pudimos registrar tu postulación"}finally{i.loading=!1}};Ve(()=>{w.value&&(clearTimeout(w.value),w.value=null)});const ke=async()=>{var c;if(!v.isAuthenticated){F.push({name:"login",query:{redirect:M.fullPath}});return}const t=(c=s.value)==null?void 0:c.companyId,e=K.value;if(!t||!e){m.error="No podemos vincular tu valoración con esta empresa.";return}const n=j.comment.trim();if(!n){m.error="Comparte un breve comentario para la empresa.";return}m.loading=!0,m.error="";try{const g=await N("/reviews",{method:"POST",data:{company:t,author:e,rating:j.rating,comment:n},auth:!0}),k=L(g);f.value=[k,...f.value.filter(D=>D.id!==k.id)],j.comment=""}catch(g){m.error=g.message||"No pudimos registrar tu valoración"}finally{m.loading=!1}},Ce=t=>t?new Date(t).toLocaleDateString("es-MX",{month:"short",day:"numeric"}):"Reciente",Se=()=>{F.back()},Ae=async t=>{t&&await O.fetchJobById(t)};return E(H,t=>{t&&Ae(t)},{immediate:!0}),(t,e)=>{var n,c,g,k,D,ee,ae,te,le;return r(),d(C,null,[s.value?(r(),d("section",qe,[a("div",Ne,[h(V,{variant:"ghost",size:"sm",onClick:Se},{default:p(()=>[...e[3]||(e[3]=[b("← Volver",-1)])]),_:1}),a("span",Be,l(s.value.modality||"Flexible"),1)]),a("div",Me,[a("article",Je,[h(B,{variant:"glass"},{title:p(()=>[b(l(s.value.title),1)]),default:p(()=>[a("p",Ee,l(s.value.company)+" · "+l(s.value.location),1),a("p",Ue,l(s.value.salaryRange||s.value.salary),1),a("div",Oe,[a("div",null,[e[4]||(e[4]=a("small",null,"Nivel",-1)),a("strong",null,l(s.value.seniority||"Intermedio"),1)]),a("div",null,[e[5]||(e[5]=a("small",null,"Publicado",-1)),a("strong",null,l(s.value.postedAgo||"Hoy"),1)]),a("div",null,[e[6]||(e[6]=a("small",null,"Horario",-1)),a("strong",null,l(s.value.schedule||"Tiempo completo"),1)]),a("div",null,[e[7]||(e[7]=a("small",null,"Aplicaciones",-1)),a("strong",null,l(J.value),1)])]),a("section",He,[e[8]||(e[8]=a("h3",null,"Descripción",-1)),a("p",null,l(s.value.description||"Experimenta con desafíos reales: iteraciones con stakeholders, research vivo y acceso a frameworks exclusivos."),1)]),a("section",Le,[e[9]||(e[9]=a("h3",null,"Requerimientos",-1)),a("ul",null,[(r(!0),d(C,null,x(pe.value,o=>(r(),d("li",{key:o},l(o),1))),128))])]),a("section",Xe,[e[10]||(e[10]=a("h3",null,"Skills",-1)),a("ul",Ke,[(r(!0),d(C,null,x(s.value.skills||de,o=>(r(),d("li",{key:o},l(o),1))),128))])]),a("div",Qe,[a("div",We,[a("label",null,[e[11]||(e[11]=a("span",null,"Mensaje para el empleador",-1)),U(a("textarea",{"onUpdate:modelValue":e[0]||(e[0]=o=>u.message=o),rows:"4",placeholder:"Haz match explicando tu interés y disponibilidad"},null,512),[[oe,u.message]])]),a("label",Ye,[e[12]||(e[12]=a("span",null,"Adjunta tu CV (PDF o DOC, máx. 5 MB)",-1)),a("input",{type:"file",accept:".pdf,.doc,.docx",onChange:ye},null,32)]),u.cvPreview?(r(),d("p",$e,[b(l(u.cvPreview)+" ",1),a("button",{type:"button",onClick:G},"Quitar")])):A("",!0)]),h(V,{size:"lg","is-loading":i.loading,disabled:y.value||i.loading||z.value,onClick:we},{default:p(()=>[b(l(y.value?"Ya postulaste":"Aplicar ahora"),1)]),_:1},8,["is-loading","disabled"]),a("p",Ge,l(J.value)+" · comunidad JobPortal ",1),z.value?(r(),d("p",Ze," Esta vacante pertenece a tu empresa, no puedes postularte. ")):A("",!0),i.error?(r(),d("p",ea,l(i.error),1)):A("",!0),e[13]||(e[13]=b(" ñ ",-1)),i.success?(r(),d("p",aa," Tu postulación fue enviada. Redirigiéndote a Mis aplicaciones… ")):A("",!0)])]),_:1})]),a("aside",ta,[h(B,null,{title:p(()=>[...e[14]||(e[14]=[b("Sobre la empresa",-1)])]),default:p(()=>[a("p",la,l(T.value.summary),1),a("ul",sa,[a("li",null,[e[15]||(e[15]=a("span",null,"Equipo",-1)),a("strong",null,l(T.value.size),1)]),a("li",null,[e[16]||(e[16]=a("span",null,"Headquarters",-1)),a("strong",null,l(T.value.hq),1)]),a("li",null,[e[17]||(e[17]=a("span",null,"Industria",-1)),a("strong",null,l(T.value.industry),1)])])]),_:1}),h(B,null,{title:p(()=>[...e[18]||(e[18]=[b("Valoraciones",-1)])]),default:p(()=>[a("div",oa,[a("div",null,[a("p",ia,l(_e.value),1),a("small",null,l(be.value)+" reseñas",1)]),a("div",na,[(r(),d(C,null,x(5,o=>a("span",{key:o,class:ne(["star",{"star--active":o<=Math.round(W.value)}])},null,2)),64))])])]),_:1})])]),a("section",ra,[a("header",null,[e[21]||(e[21]=a("div",null,[a("p",{class:"section-kicker"},"Feedback de cohorts"),a("h3",null,"Lo que dice la comunidad.")],-1)),a("div",ua,[a("label",null,[e[19]||(e[19]=a("span",null,"Valoración",-1)),U(a("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>j.rating=o)},[(r(),d(C,null,x([5,4,3,2,1],o=>a("option",{key:o,value:o},l(o)+" / 5",9,da)),64))],512),[[Ie,j.rating,void 0,{number:!0}]])]),U(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>j.comment=o),placeholder:"Comparte tu experiencia con este equipo",rows:"3"},null,512),[[oe,j.comment]]),h(V,{size:"sm","is-loading":m.loading,onClick:ke},{default:p(()=>[...e[20]||(e[20]=[b("Publicar",-1)])]),_:1},8,["is-loading"]),m.error?(r(),d("p",ca,l(m.error),1)):A("",!0)])]),a("ul",pa,[(r(!0),d(C,null,x(f.value,o=>(r(),d("li",{key:o.id,class:"review-card"},[a("div",va,[a("strong",null,l(o.author),1),a("span",null,l(Ce(o.date)),1)]),a("div",ma,[(r(),d(C,null,x(5,se=>a("span",{key:se,class:ne(["star",{"star--active":se<=o.rating}])},null,2)),64)),a("small",null,l(o.rating)+"/5",1)]),a("p",null,l(o.comment),1)]))),128))])])])):(r(),d("section",_a,[h(B,null,{title:p(()=>[...e[22]||(e[22]=[b("Selecciona una vacante",-1)])]),default:p(()=>[e[23]||(e[23]=a("p",null,"Explora el radar y elige un rol para ver los detalles.",-1))]),_:1})])),(r(),Fe(Te,{to:"body"},[R.value?(r(),d("div",ba,[a("div",fa,[a("header",ga,[a("div",null,[e[24]||(e[24]=a("p",{class:"application-review__eyebrow"},"Confirmar postulación",-1)),e[25]||(e[25]=a("h3",null,"Envía tu perfil con confianza",-1)),a("p",null,"Verifica que los datos coincidan antes de compartirlos con "+l((n=s.value)==null?void 0:n.company)+".",1)]),a("button",{type:"button",class:"application-review__close","aria-label":"Cerrar",onClick:Z}," × ")]),a("div",ya,[a("section",wa,[e[28]||(e[28]=a("p",{class:"application-review__label"},"Vacante",-1)),a("p",ha,l((c=s.value)==null?void 0:c.title),1),a("p",ja,l((g=s.value)==null?void 0:g.company)+" · "+l((k=s.value)==null?void 0:k.location),1),a("ul",ka,[a("li",null,[e[26]||(e[26]=a("span",null,"Modalidad",-1)),a("strong",null,l(((D=s.value)==null?void 0:D.modality)||"Flexible"),1)]),a("li",null,[e[27]||(e[27]=a("span",null,"Aplicaciones",-1)),a("strong",null,l(J.value),1)])])]),a("section",Ca,[e[31]||(e[31]=a("p",{class:"application-review__label"},"Candidato",-1)),a("p",Sa,l((ee=ie(v).user)==null?void 0:ee.name),1),a("p",Aa,l((ae=ie(v).user)==null?void 0:ae.email),1),a("ul",xa,[a("li",null,[e[29]||(e[29]=a("span",null,"Mensaje",-1)),a("strong",null,l((te=u.message)!=null&&te.trim()?"Personalizado":"Sin mensaje"),1)]),a("li",null,[e[30]||(e[30]=a("span",null,"CV",-1)),a("strong",null,l(u.cvPreview?"Adjunto":"Pendiente"),1)])])])]),a("section",Pa,[a("article",null,[e[32]||(e[32]=a("p",{class:"application-review__label"},"Mensaje al empleador",-1)),a("p",null,l(((le=u.message)==null?void 0:le.trim())||"Sin mensaje adicional"),1)]),a("article",null,[e[33]||(e[33]=a("p",{class:"application-review__label"},"CV adjunto",-1)),a("p",null,l(u.cvPreview||"No adjuntaste archivo"),1)])]),a("footer",Ra,[e[36]||(e[36]=a("p",{class:"application-review__hint"},"Tip: un mensaje breve y un CV actualizado elevan tus probabilidades.",-1)),a("div",Va,[h(V,{variant:"ghost",size:"sm",disabled:i.loading,onClick:Z},{default:p(()=>[...e[34]||(e[34]=[b(" Seguir editando ",-1)])]),_:1},8,["disabled"]),h(V,{size:"sm","is-loading":i.loading,onClick:je},{default:p(()=>[...e[35]||(e[35]=[b(" Enviar postulación ",-1)])]),_:1},8,["is-loading"])])])])])):A("",!0)]))],64)}}},Da=xe(Fa,[["__scopeId","data-v-91b1e260"]]);export{Da as default};
